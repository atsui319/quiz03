<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>BoardConsole Lite</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        :root { --bg: #0f1115; --primary: #4aa3ff; --success: #2ecc71; --danger: #ff5c5c; }
        body { font-family: sans-serif; background: var(--bg); color: #e5e7eb; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background: #161a22; padding: 25px; border-radius: 12px; border: 1px solid #2a2f3a; width: 100%; max-width: 500px; text-align: center; }
        input { width: 90%; padding: 15px; font-size: 1.2rem; border-radius: 8px; border: 2px solid #333; background: #000; color: #fff; margin-bottom: 15px; }
        button { width: 90%; padding: 15px; font-size: 1.2rem; cursor: pointer; border-radius: 8px; border: none; font-weight: bold; margin-bottom: 10px; }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-success { background: var(--success); color: #fff; }
        .btn-danger { background: var(--danger); color: #fff; }
        #status { margin-top: 10px; font-weight: bold; color: var(--primary); }
    </style>
</head>
<body>

<div id="setup-ui" class="container">
    <h2>ãƒœãƒ¼ãƒ‰æ©Ÿèƒ½åˆ†é›¢ç‰ˆ</h2>
    <button class="btn-primary" onclick="initRole('admin')">ğŸ’» ç®¡ç†è€…ï¼ˆåˆ¶å¾¡ãƒ»ç”»é¢é–‹ãï¼‰</button>
    <button class="btn-success" onclick="initRole('player')">ğŸ“± å›ç­”è€…ï¼ˆå…¥åŠ›ã™ã‚‹ï¼‰</button>
</div>

<div id="admin-ui" class="container" style="display:none;">
    <h3>ç®¡ç†è€…ãƒ‘ãƒãƒ«</h3>
    <button class="btn-primary" onclick="openDisplay()">ğŸ“º å…±æœ‰ç”»é¢ã‚’é–‹ã</button>
    <button class="btn-success" onclick="db.ref('reveal').set(true)">ğŸ“¢ å…¨å“¡ã®å›ç­”ã‚’å…¬é–‹</button>
    <button class="btn-danger" onclick="resetBoard()">ğŸš® ãƒœãƒ¼ãƒ‰ã‚’å…¨æ¶ˆå»</button>
    <div id="status">å…±æœ‰ç”»é¢ã«å›ç­”ã‚’è¡¨ç¤ºä¸­</div>
</div>

<div id="player-ui" class="container" style="display:none;">
    <input type="text" id="p-name" placeholder="ã‚ãªãŸã®åå‰">
    <input type="text" id="p-ans" placeholder="ç­”ãˆã‚’è¨˜å…¥" oninput="reportTyping(this.value)">
    <button class="btn-success" onclick="sendAns()">é€ä¿¡ã™ã‚‹</button>
    <div id="status">å¾…æ©Ÿä¸­</div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://realtime-database-c0015-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let myRole = "";
    let subWindow = null;

    function initRole(role) {
        myRole = role;
        document.getElementById('setup-ui').style.display = 'none';
        document.getElementById(role + '-ui').style.display = 'block';
        if(role === 'admin') {
            db.ref().on('value', snap => {
                if(subWindow) subWindow.sync(snap.val());
            });
        }
    }

    // --- å›ç­”è€…æ©Ÿèƒ½ ---
    function reportTyping(val) {
        const name = document.getElementById('p-name').value.trim();
        if(name) db.ref('typing/' + name).set(val.length > 0);
    }

    function sendAns() {
        const name = document.getElementById('p-name').value.trim();
        const ans = document.getElementById('p-ans').value.trim();
        if(!name || !ans) return alert("åå‰ã¨ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        db.ref('answers/' + name).set(ans);
        db.ref('typing/' + name).set(false);
        document.getElementById('status').innerText = "é€ä¿¡å®Œäº†ï¼";
    }

    // --- ç®¡ç†è€…æ©Ÿèƒ½ ---
    function resetBoard() {
        if(confirm("å…¨å“¡ã®å›ç­”ã‚’æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ")) {
            db.ref().set({ answers: null, typing: null, reveal: false });
        }
    }

    function openDisplay() {
        subWindow = window.open("", "BoardDisplay", "width=1000,height=700");
        subWindow.document.write(`
            <html><head><style>
                body { background: #000; color: #fff; font-family: sans-serif; text-align: center; padding: 20px; }
                #board-area { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
                .card { background: #222; border: 4px solid #444; border-radius: 15px; min-width: 250px; padding: 20px; }
                .name { font-size: 1.2rem; color: #aaa; margin-bottom: 10px; }
                .ans { font-size: 2.5rem; font-weight: bold; color: #f1c40f; min-height: 1.2em; }
                @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
            </style></head><body>
                <h1>LIVE BOARD</h1>
                <div id="board-area"></div>
                <script>
                    window.sync = (data) => {
                        if(!data) return;
                        const area = document.getElementById('board-area');
                        const names = Array.from(new Set([...Object.keys(data.answers || {}), ...Object.keys(data.typing || {})]));
                        area.innerHTML = names.map(n => {
                            const ans = data.answers?.[n];
                            const isTyping = data.typing?.[n];
                            let displayAns = "";
                            if (data.reveal) {
                                displayAns = ans || "";
                            } else {
                                displayAns = ans ? "ï¼Ÿï¼Ÿï¼Ÿ" : (isTyping ? "<span style='color:#3498db; animation:blink 1s infinite;'>ğŸ–Š å…¥åŠ›ä¸­...</span>" : "");
                            }
                            if(!displayAns) return "";
                            return '<div class="card"><div class="name">'+n+'</div><div class="ans">'+displayAns+'</div></div>';
                        }).join('');
                    };
                <\/script></body></html>
        `);
    }
</script>
</body>
</html>
